---
layout: post
title: MySQL行连接，列连接
date: 2017-03-19 11:25:32 +0800
categories: mysql
---

> ref: https://segmentfault.com/a/1190000004328103

关系型数据库在应用时，有时想把结果进行一些连接，包括行连接，列连接等有时都会用到。本文介绍几个常用的mysql连接函数。在此基础上，可以实现较丰富的mysql查询。

## concat
关系数据库查询时有时希望把查询结果进行连接，常使用concat实现。

`concat(String,String...)`

concat函数支持将多个string参数连接成一个string。如：

|field1|field2|
|  tv1  | tv2   |
|  tv3  | tv4   |

``` sql
select concat(filed1,field2) ftom tb;
```
将返回：

|tv1tv2|
|tv3tv4|

不同类型的filed会有对应的转码方式。MySQL的concat函数在连接字符串的时候，只要其中一个是NULL,那么将返回NULL。

## concat_ws
concat函数在连接字符串时没有指定连接符的功能。concat_ws是concat with separator的意思。该函数功能和concat类似，只是在连接时可以指定separator。

`concat_ws(separator,string,string...)`

``` sql
select concat_ws(',',field1,field2) from tb;
```
将得到

|tv1,tv2|
|tv3,tv4|

concat_ws不会忽略空值，但会忽略Null。

## group_concat
前面两个concat函数都是在不同的列上进行连接，或连接字符串，有时想把某一列的所有值连接起来。这时就要用到group_concat函数。

group_concat实际上是一个聚合函数，可以实现把一列的值聚合到一起，聚合的方法不同于count,sum等计数函数，而是concat。
``` sql
GROUP_CONCAT([DISTINCT] expr [,expr ...]
             [ORDER BY {unsigned_integer | col_name | expr}
                              [ASC | DESC] [,col_name ...]]
                                           [SEPARATOR str_val])
```
最简单的使用:
``` sql
select group_concat(field1) from tb;
```

|tv1,tv3|

把field1这一列的所有值拿出来连接在一起组成一个字符串返回。

因为是聚合函数，所以和group组合起来使用，将在组内对列进行连接。同时，也可以传多个field进去，此时把每一行的多列连接起来组成一个列，再对列进行连接。默认情况下列内连接符号是',',也可以在参数中指定separator。

连接过程中还可以指定组内排序。如：
``` sql
select group_concat(field1 order by field1 desc SEPARATOR '-');
``` 
将得到

|tv3-tv1|

## wm_concat
除了在mysql中使用类似的函数之外，在hive中也有cancat，group_concat函数，使用方法类似，在odps中也有wm_concat具备和group_concat类似的功能。

