---
layout: post
title: Linux常用网络指令
date: 2018-02-15 16:51:24 +0800
categories: linux
---

> ref: [鸟哥私房菜](http://cn.linux.vbird.org/linux_server/0140networkcommand.php)

### ifconfig & ifup & ifdown

### route

### (满足前两组的功能) ip	

### traceroute

### ping

ping命令是常用的网络命令，*它通常用来测试与目标主机的连通性，我们经常会说“ping一下某机器，看是不是开着”、不能打开网页时会说“你先ping网关地址192.168.1.1试试”。*

它通过发送**ICMP(internet control message protocol,网络控制报文协议)** *ECHO_REQUEST*数据包到网络主机（send ICMP ECHO_REQUEST to network hosts），并显示响应情况，这样我们就可以根据它输出的信息来确定目标主机是否可访问（但这不是绝对的）。

> 有些服务器为了防止通过ping探测到，通过防火墙设置了禁止ping或者在内核参数中禁止ping，这样就不能通过ping确定该主机是否还处于开启状态。

**linux下的ping和windows下的ping稍有区别,linux下ping不会自动终止,需要按ctrl+c终止或者用参数-c指定要求完成的回应次数。**

```
ping [参数] 主机名/IP/域名

参数：(* 常用)

    -b 允许ping一个广播地址 
    -d 使用Socket的SO_DEBUG功能。
?   -f 极限检测。大量且快速地送网络封包给一台机器，看它的回应。
    -n 只输出数值。
    -q 不显示任何传送封包的信息，只显示最后的结果。
    -r 忽略普通的Routing Table，直接将数据包送到远端主机上。通常是查看本机的网络接口是否有问题。
?   -R 记录路由过程。
    -v 详细显示指令的执行过程。
*   -c 数目：在发送指定数目的包后停止。
*   -i 秒数：设定间隔几秒送一个网络封包给一台机器，预设值是一秒送一次。
    -I 网络界面：使用指定的网络界面送出数据包。
    -l 前置载入：设置在送出要求信息之前，先行发出的数据包。
    -p 范本样式：设置填满数据包的范本样式。
*   -s 字节数：指定发送的数据字节数，预设值是56，加上8字节的ICMP头，一共是64ICMP数据字节。
    -t 存活数值：设置存活数值TTL的大小。
```

> e.g.:

1. ping 的通的情况
    ```
    [root@localhost ~]# ping 192.168.120.205
    PING 192.168.120.205 (192.168.120.205) 56(84) bytes of data.
    64 bytes from 192.168.120.205: icmp_seq=1 ttl=64 time=0.720 ms
    64 bytes from 192.168.120.205: icmp_seq=2 ttl=64 time=0.181 ms
    64 bytes from 192.168.120.205: icmp_seq=3 ttl=64 time=0.191 ms
    64 bytes from 192.168.120.205: icmp_seq=4 ttl=64 time=0.188 ms
    64 bytes from 192.168.120.205: icmp_seq=5 ttl=64 time=0.189 ms
    
    --- 192.168.120.205 ping statistics ---
    5 packets transmitted, 5 received, 0% packet loss, time 4000ms
    rtt min/avg/max/mdev = 0.181/0.293/0.720/0.214 ms
    [root@localhost ~]# 
    ```
2. ping 不通的情况
    ```
    [root@localhost ~]# ping 192.168.120.202
    PING 192.168.120.202 (192.168.120.202) 56(84) bytes of data.
    From 192.168.120.204 icmp_seq=1 Destination Host Unreachable
    From 192.168.120.204 icmp_seq=2 Destination Host Unreachable
    From 192.168.120.204 icmp_seq=3 Destination Host Unreachable
    From 192.168.120.204 icmp_seq=4 Destination Host Unreachable
    From 192.168.120.204 icmp_seq=5 Destination Host Unreachable
    From 192.168.120.204 icmp_seq=6 Destination Host Unreachable
    
    --- 192.168.120.202 ping statistics ---
    8 packets transmitted, 0 received, +6 errors, 100% packet loss, time 7005ms
    , pipe 4
    ```
3. ping 网关
    ```
    [root@localhost ~]# route
    Kernel IP routing table
    Destination     Gateway         Genmask         Flags Metric Ref    Use Iface
    192.168.120.0   *               255.255.255.0   U     0      0        0 eth0
    192.168.0.0     192.168.120.1   255.255.0.0     UG    0      0        0 eth0
    10.0.0.0        192.168.120.1   255.0.0.0       UG    0      0        0 eth0
    default         192.168.120.240 0.0.0.0         UG    0      0        0 eth0
    [root@localhost ~]# ping -b 192.168.120.1
    PING 192.168.120.1 (192.168.120.1) 56(84) bytes of data.
    64 bytes from 192.168.120.1: icmp_seq=1 ttl=255 time=2.02 ms
    64 bytes from 192.168.120.1: icmp_seq=2 ttl=255 time=1.83 ms
    64 bytes from 192.168.120.1: icmp_seq=3 ttl=255 time=1.68 ms
    64 bytes from 192.168.120.1: icmp_seq=4 ttl=255 time=1.98 ms
    64 bytes from 192.168.120.1: icmp_seq=5 ttl=255 time=1.88 ms
    
    --- 192.168.120.1 ping statistics ---
    5 packets transmitted, 5 received, 0% packet loss, time 4000ms
    rtt min/avg/max/mdev = 1.682/1.880/2.020/0.129 ms
    ```
4. ping 指定次数
    ```
    [root@localhost ~]# ping -c 10 192.168.120.206
    PING 192.168.120.206 (192.168.120.206) 56(84) bytes of data.
    64 bytes from 192.168.120.206: icmp_seq=1 ttl=64 time=1.25 ms
    64 bytes from 192.168.120.206: icmp_seq=2 ttl=64 time=0.260 ms
    64 bytes from 192.168.120.206: icmp_seq=3 ttl=64 time=0.242 ms
    64 bytes from 192.168.120.206: icmp_seq=4 ttl=64 time=0.271 ms
    64 bytes from 192.168.120.206: icmp_seq=5 ttl=64 time=0.274 ms
    64 bytes from 192.168.120.206: icmp_seq=6 ttl=64 time=0.295 ms
    64 bytes from 192.168.120.206: icmp_seq=7 ttl=64 time=0.269 ms
    64 bytes from 192.168.120.206: icmp_seq=8 ttl=64 time=0.270 ms
    64 bytes from 192.168.120.206: icmp_seq=9 ttl=64 time=0.253 ms
    64 bytes from 192.168.120.206: icmp_seq=10 ttl=64 time=0.289 ms
    
    --- 192.168.120.206 ping statistics ---
    10 packets transmitted, 10 received, 0% packet loss, time 9000ms
    rtt min/avg/max/mdev = 0.242/0.367/1.251/0.295 ms
    ``` 
5. 时间间隔和次数限制的 ping
    ```
    [root@localhost ~]# ping -c 10 -i 0.5 192.168.120.206
    PING 192.168.120.206 (192.168.120.206) 56(84) bytes of data.
    64 bytes from 192.168.120.206: icmp_seq=1 ttl=64 time=1.24 ms
    64 bytes from 192.168.120.206: icmp_seq=2 ttl=64 time=0.235 ms
    64 bytes from 192.168.120.206: icmp_seq=3 ttl=64 time=0.244 ms
    64 bytes from 192.168.120.206: icmp_seq=4 ttl=64 time=0.300 ms
    64 bytes from 192.168.120.206: icmp_seq=5 ttl=64 time=0.255 ms
    64 bytes from 192.168.120.206: icmp_seq=6 ttl=64 time=0.264 ms
    64 bytes from 192.168.120.206: icmp_seq=7 ttl=64 time=0.263 ms
    64 bytes from 192.168.120.206: icmp_seq=8 ttl=64 time=0.331 ms
    64 bytes from 192.168.120.206: icmp_seq=9 ttl=64 time=0.247 ms
    64 bytes from 192.168.120.206: icmp_seq=10 ttl=64 time=0.244 ms
    
    --- 192.168.120.206 ping statistics ---
    10 packets transmitted, 10 received, 0% packet loss, time 4499ms
    rtt min/avg/max/mdev = 0.235/0.362/1.241/0.294 ms
    [root@localhost ~]# ping -c 10 -i 0.01 192.168.120.206
    PING 192.168.120.206 (192.168.120.206) 56(84) bytes of data.
    64 bytes from 192.168.120.206: icmp_seq=1 ttl=64 time=0.244 ms
    64 bytes from 192.168.120.206: icmp_seq=2 ttl=64 time=0.195 ms
    64 bytes from 192.168.120.206: icmp_seq=3 ttl=64 time=0.219 ms
    64 bytes from 192.168.120.206: icmp_seq=4 ttl=64 time=0.204 ms
    64 bytes from 192.168.120.206: icmp_seq=5 ttl=64 time=3.56 ms
    64 bytes from 192.168.120.206: icmp_seq=6 ttl=64 time=1.93 ms
    64 bytes from 192.168.120.206: icmp_seq=7 ttl=64 time=0.193 ms
    64 bytes from 192.168.120.206: icmp_seq=8 ttl=64 time=0.193 ms
    64 bytes from 192.168.120.206: icmp_seq=9 ttl=64 time=0.202 ms
    64 bytes from 192.168.120.206: icmp_seq=10 ttl=64 time=0.211 ms
    
    --- 192.168.120.206 ping statistics ---
    10 packets transmitted, 10 received, 0% packet loss, time 90ms
    rtt min/avg/max/mdev = 0.193/0.716/3.564/1.080 ms
    ```
6. 通过域名 ping 公网上的站点
    ```
    peida-VirtualBox ~ # ping -c 5 www.58.com
    PING www.58.com (211.151.111.30) 56(84) bytes of data.
    64 bytes from 211.151.111.30: icmp_req=1 ttl=49 time=14.7 ms
    64 bytes from 211.151.111.30: icmp_req=2 ttl=49 time=16.4 ms
    64 bytes from 211.151.111.30: icmp_req=3 ttl=49 time=15.2 ms
    64 bytes from 211.151.111.30: icmp_req=4 ttl=49 time=14.6 ms
    64 bytes from 211.151.111.30: icmp_req=5 ttl=49 time=19.9 ms
    
    --- www.58.com ping statistics ---
    5 packets transmitted, 5 received, 0% packet loss, time 20101ms
    rtt min/avg/max/mdev = 14.618/16.192/19.917/1.965 ms
    peida-VirtualBox ~ # 
    ``` 
7. 多参数使用
    ```
    [root@localhost ~]# ping -i 3 -s 1024 -t 255 192.168.120.206
    PING 192.168.120.206 (192.168.120.206) 1024(1052) bytes of data.
    1032 bytes from 192.168.120.206: icmp_seq=1 ttl=64 time=1.99 ms
    1032 bytes from 192.168.120.206: icmp_seq=2 ttl=64 time=0.694 ms
    1032 bytes from 192.168.120.206: icmp_seq=3 ttl=64 time=0.300 ms
    1032 bytes from 192.168.120.206: icmp_seq=4 ttl=64 time=0.481 ms
    1032 bytes from 192.168.120.206: icmp_seq=5 ttl=64 time=0.415 ms
    1032 bytes from 192.168.120.206: icmp_seq=6 ttl=64 time=0.600 ms
    1032 bytes from 192.168.120.206: icmp_seq=7 ttl=64 time=0.411 ms
    1032 bytes from 192.168.120.206: icmp_seq=8 ttl=64 time=0.281 ms
    1032 bytes from 192.168.120.206: icmp_seq=9 ttl=64 time=0.318 ms
    1032 bytes from 192.168.120.206: icmp_seq=10 ttl=64 time=0.362 ms
    1032 bytes from 192.168.120.206: icmp_seq=11 ttl=64 time=0.408 ms
    1032 bytes from 192.168.120.206: icmp_seq=12 ttl=64 time=0.445 ms
    1032 bytes from 192.168.120.206: icmp_seq=13 ttl=64 time=0.397 ms
    1032 bytes from 192.168.120.206: icmp_seq=14 ttl=64 time=0.406 ms
    1032 bytes from 192.168.120.206: icmp_seq=15 ttl=64 time=0.458 ms
    
    --- 192.168.120.206 ping statistics ---
    15 packets transmitted, 15 received, 0% packet loss, time 41999ms
    rtt min/avg/max/mdev = 0.281/0.531/1.993/0.404 ms
    ```
    
    > 说明： -i 3 发送周期为 3秒 -s 设置发送包的大小为1024 -t 设置TTL值为 255
